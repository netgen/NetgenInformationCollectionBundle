imports:
    - { resource: actions.yml }
    - { resource: core/persistence.yml }
    - { resource: factories.yml }
    - { resource: forms.yml }
    - { resource: legacy_handlers.yml }
    - { resource: admin.yml }
    - { resource: anonymizers.yml }
    - { resource: ibexa_admin.yml }
    - { resource: form_fieldtype_handlers.yaml }

parameters:

services:
    netgen_information_collection.listener:
        class: Netgen\Bundle\InformationCollectionBundle\Listener\InformationCollectedListener
        arguments:
            - '@netgen_information_collection.action.registry'
        tags:
            - { name: kernel.event_subscriber }

    netgen_information_collection.field_handler.registry:
        class: Netgen\InformationCollection\Core\Persistence\FieldHandler\FieldHandlerRegistry
        arguments:
            - !tagged_iterator netgen_information_collection.field_handler.custom

    netgen_information_collection.mailer:
        class: Netgen\InformationCollection\Core\Mailer\SymfonyMailerBasedMailer
        arguments:
            - '@mailer.mailer'

    netgen_information_collection.form.extension.field_definition:
        class: Netgen\Bundle\InformationCollectionBundle\Ibexa\ContentForms\FieldDefinitionTypeExtension
        tags:
            - { name: form.type_extension, extended_type: Ibexa\AdminUi\Form\Type\FieldDefinition\FieldDefinitionType }

    netgen_information_collection.form.extension.content_field:
        class: Netgen\Bundle\InformationCollectionBundle\Ibexa\ContentForms\ContentFieldTypeExtension
        tags:
            - { name: form.type_extension, extended_type: Ibexa\ContentForms\Form\Type\Content\ContentFieldType }

    netgen_information_collection.validator.info_collector:
        class: Netgen\Bundle\InformationCollectionBundle\Ibexa\ContentForms\InfoCollectorContentValidator
        tags:
            - { name: ibexa.repository.content.validator, priority: 255 }

    netgen_information_collection.domain_object_mapper:
        class: Netgen\InformationCollection\Core\Mapper\DomainObjectMapper
        arguments:
            - '@ibexa.api.repository'


    netgen_information_collection.twig.extension.rendering:
        class: Netgen\Bundle\InformationCollectionBundle\Templating\Twig\Extensions\FieldRenderingExtension
        public: false
        tags:
            - { name: twig.extension }

    netgen_information_collection.twig.runtime.rendering:
        class: Netgen\Bundle\InformationCollectionBundle\Templating\Twig\Extensions\FieldRenderingRuntime
        # public: false
        arguments:
            - '@twig'
            - '@ibexa.config.resolver'
        tags:
            - { name: twig.runtime }

    netgen_information_collection.form.information_collection_type:
        class: Netgen\Bundle\InformationCollectionBundle\Ibexa\ContentForms\InformationCollectionType
        arguments:
            - '@netgen_information_collection.captcha.service'
            - '@ibexa.config.resolver'
        tags:
            - { name: form.type }

    netgen_information_collection.form.information_collection_field_type:
        class: Netgen\Bundle\InformationCollectionBundle\Ibexa\ContentForms\InformationCollectionFieldType
        arguments:
            - '@Ibexa\ContentForms\FieldType\FieldTypeFormMapperDispatcher'
        tags:
            - { name: form.type }

    netgen_information_collection.handler:
        class: Netgen\InformationCollection\Handler
        public: true
        arguments:
            - "@form.factory"
            - "@ibexa.api.service.content_type"
            - "@event_dispatcher"

    netgen_information_collection.captcha.service:
        class: Netgen\InformationCollection\Core\Service\CaptchaService
        arguments:
            - '@ibexa.api.service.content_type'
            - '@ibexa.config.resolver'

    netgen_information_collection.export.json:
        class: Netgen\InformationCollection\Core\Export\JsonExportResponseFormatter
        tags:
            - { name: netgen_information_collection.export.formatter }

    netgen_information_collection.form.captcha_type:
        class: Netgen\Bundle\InformationCollectionBundle\Form\Type\CaptchaType
        arguments:
            - '@netgen_information_collection.listener.captcha_validation'
        tags:
            - { name: form.type }

    netgen_information_collection.captcha.extension:
        class: Netgen\Bundle\InformationCollectionBundle\Templating\Twig\Extensions\CaptchaExtension
        tags:
            - { name: twig.extension }

    netgen_information_collection.captcha.runtime:
        class: Netgen\Bundle\InformationCollectionBundle\Templating\Twig\Extensions\CaptchaRuntime
        arguments:
            - '@netgen_information_collection.captcha.service'
        tags:
            - { name: twig.runtime }

    netgen_information_collection.form.fieldtype_handler_registry:
        class: Netgen\Bundle\InformationCollectionBundle\Form\FieldTypeHandlerRegistry
